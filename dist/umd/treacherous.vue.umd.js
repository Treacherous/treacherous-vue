!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TreacherousVue=t():e.TreacherousVue=t()}(window,function(){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){function s(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}s(r(4)),s(r(2))},function(e,t,r){var s=r(3);t.PropertyResolver=s.PropertyResolver},function(e,t){var r=function(){return function(e,t){this.callback=e,this.predicate=t}}();t.EventListener=r},function(e,t){var r=function(){function e(){var e=this;this.indexRegex=/\[(\d)]/,this.splitRegex=/\./,this.resolveProperty=function(t,r){var s=null,i=[],o="";if("string"!=typeof r)throw new TypeError("propertyChain is not a string");return r.split(e.splitRegex).forEach(function(r){var a=-1;if(e.indexRegex.test(r)&&(a=e.indexRegex.exec(r)[1],r=r.replace(e.indexRegex,"")),s){if("object"!=typeof s)throw new TypeError('"'+s+'"  does not seem to be an object');if(a>=0){if(!(a<s[r].length))throw new TypeError('cannot find index "'+a+'" in '+o);i.push(s=s[r][a]),o=r[a]}else{if(!(r in s))throw new TypeError('cannot resolve "'+r+'" in '+o);i.push(s=s[r]),o=r}}else a>=0?0==r.length?(i.push(s=t[a]),o=a):(i.push(s=t[r][a]),o=r[a]):(o=r,i.push(s=t[r]))}),i[i.length-1]}}return e.prototype.decomposePropertyRoute=function(e){for(var t,r=[],s=e.split(this.splitRegex),i=0;i<s.length;i++)this.indexRegex.test(s[i])?(t=this.indexRegex.exec(s[i])[1],r.push(s[i].replace(this.indexRegex,"")),r.push("["+t+"]")):r.push(s[i]);return r},e.prototype.getPropertyRouteSection=function(e,t){return void 0===t&&(t=0),this.decomposePropertyRoute(e)[t]},e.prototype.buildPropertyRoute=function(e){for(var t="",r=0;r<e.length;r++)0!=t.length?e[r].indexOf("[")>=0?t+=""+e[r]:t+="."+e[r]:t+=e[r];return t},e}();t.PropertyResolver=r},function(e,t,r){var s=r(2),i=function(){return function(e){var t=this;this.sender=e,this.listeners=[],this.subscribe=function(e,r){return t.listeners.push(new s.EventListener(e,r)),function(){t.unsubscribe(e)}},this.unsubscribe=function(e){for(var r=0;r<t.listeners.length;r++)if(t.listeners[r].callback==e)return void t.listeners.splice(r,1)},this.unsubscribeAll=function(){t.listeners=[]},this.publish=function(e){t.listeners.forEach(function(r){r.predicate?r.predicate(e)&&setTimeout(function(){r.callback(e,t.sender)},1):setTimeout(function(){r.callback(e,t.sender)},1)})},this.publishSync=function(e){t.listeners.forEach(function(r){r.predicate?r.predicate(e)&&r.callback(e,t.sender):r.callback(e,t.sender)})},this.getSubscriptionCount=function(){return t.listeners.length}}}();t.EventHandler=i},function(e,t,r){"use strict";r.r(t);function s(e,t,r,s){return new(r||(r=Promise))(function(i,o){function a(e){try{l(s.next(e))}catch(e){o(e)}}function n(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,n)}l((s=s.apply(e,t||[])).next())})}class i extends Error{constructor(e){super(e),this.message=e}}var o=r(1);class a{constructor(e=new o.PropertyResolver){this.propertyResolver=e,this.isPropertyRoute=(e=>e.indexOf(".")>=0),this.isIndexRoute=(e=>e.indexOf("[")>=0),this.resolvePropertyRules=((e,t)=>{const r=this.propertyResolver.decomposePropertyRoute(e),s=r[r.length-1],i=this.traverseRulesForRoutes(r,t);return i?i.getRulesForProperty?i.getRulesForProperty(s):i:null}),this.getMatchingRuleForProperty=((e,t)=>{let r;for(let s=0;s<t.length;s++)if((r=t[s]).isForEach&&(r=r.internalRule),r.getRulesForProperty&&r.rules[e])return r}),this.traverseRulesForRoutes=((e,t)=>{const r=e.shift();let s=t;if(t.rules&&(s=s.rules[r]),!s)return null;if(0==e.length)return s;const i=e[0];if(!i)return t;if(this.isIndexRoute(i)){e.shift();const t=[];if(s.forEach(e=>{e.isForEach&&t.push(e.internalRule)}),e.length>0){const r=[];return t.forEach(t=>{const s=e.slice();this.traverseRulesForRoutes(s,t).forEach(e=>{r.push(e)})}),r}return t}if(0==e.length)return s;const o=this.getMatchingRuleForProperty(i,s);return e.length>0?this.traverseRulesForRoutes(e,o):o})}}class n{static isDateType(e){return"function"==typeof e.getMonth}static isFunctionType(e){return"function"==typeof e}static isSimpleType(e){return"string"==typeof e||"number"==typeof e}static isArrayType(e){return"[object Array]"===Object.prototype.toString.call(e)}static isEmptyValue(e){return void 0===e||null===e||0==e.length}static isObjectOrArray(e){return!!e&&(e.constructor===Array||e.constructor===Object)}static isRuleset(e){return"function"==typeof e.addRule}static isForEach(e){return e.isForEach}}class l{constructor(){this.promiseCallbacks=[],this.validationCounter=0,this.waitForCompletion=(()=>s(this,void 0,void 0,function*(){if(!this.validationCounter)return;return new Promise(e=>{this.promiseCallbacks.push(()=>e())})})),this.countPromise=(e=>s(this,void 0,void 0,function*(){if(!e)return;if(!e.then)throw new Error("Non-Promise pass in: "+e);this.incrementCounter();const t=yield e;return this.decrementCounter(),t})),this.decrementCounter=(()=>{if(this.validationCounter--,!this.validationCounter)for(;this.promiseCallbacks.length;)this.promiseCallbacks.shift()()}),this.incrementCounter=(()=>{this.validationCounter++})}}class u{constructor(e,t,r){this.property=e,this.isValid=t,this.error=r}}class h{constructor(e){this.isValid=e}}var c=r(0);class d{constructor(){this.propertySanitizerRegex=/\[(.*?)]/g,this.propertyNameOverrideCache={},this.recurseTree=((e,t)=>{for(const r in e.rules){const s=this.updateRouteName(t,r);e.rules[r].forEach(e=>{n.isForEach(e)&&n.isRuleset(e.internalRule)&&this.recurseTree(e.internalRule,s),n.isRuleset(e)&&this.recurseTree(e,s)})}if(0!=Object.keys(e.propertyDisplayNames).length)for(const r in e.propertyDisplayNames){const s=this.updateRouteName(t,r);this.propertyNameOverrideCache[s]=e.propertyDisplayNames[r]}}),this.updateRouteName=((e,t)=>e.length>0?`${e}.${t}`:t),this.cacheDisplayNamesFor=(e=>{this.recurseTree(e,"")}),this.getDisplayNameFor=(e=>{const t=e.replace(this.propertySanitizerRegex,"");return this.propertyNameOverrideCache[t]||e})}}class p{constructor(e,t=new a,r,i,o,p){this.fieldErrorProcessor=e,this.ruleResolver=t,this.modelResolverFactory=r,this.localeHandler=i,this.ruleset=p,this.propertyErrors={},this.validatePropertyWithRuleLinks=((e,t)=>s(this,void 0,void 0,function*(){const r=this.fieldErrorProcessor.checkFieldForErrors(this.modelResolver,e,t),s=yield this.promiseCounter.countPromise(r),i=this.hasErrors();if(!s){if(this.propertyErrors[e]){delete this.propertyErrors[e];const t=new u(e,!0);this.propertyStateChangedEvent.publish(t),i&&this.hasErrors()||this.modelStateChangedEvent.publish(new h(!0))}return this.promiseCounter.waitForCompletion()}const o=this.propertyErrors[e];if(this.propertyErrors[e]=s,s!=o){const t=new u(e,!1,s);this.propertyStateChangedEvent.publish(t),i||this.modelStateChangedEvent.publish(new h(!1))}return this.promiseCounter.waitForCompletion()})),this.validatePropertyWithRuleSet=((e,t)=>{let r;for(const s in t.rules)r=`${e}.${s}`,this.validatePropertyWithRules(r,t.getRulesForProperty(s))}),this.validatePropertyWithRules=((e,t)=>{const r=[],s=[];let i;try{i=this.modelResolver.resolve(e)}catch(t){throw console.warn(`Failed to resolve property ${e} during validation. Does it exist in your model?`),t}t.forEach(t=>{n.isForEach(t)?n.isArrayType(i)?i.forEach((r,s)=>{const i=`${e}[${s}]`;this.validatePropertyWithRules(i,[t.internalRule])}):n.isRuleset(t.internalRule)?s.push(t.internalRule):r.push(t.internalRule):n.isRuleset(t)?s.push(t):r.push(t)}),this.validatePropertyWithRuleLinks(e,r),s.forEach(t=>{this.validatePropertyWithRuleSet(e,t)})}),this.startValidateProperty=(e=>s(this,void 0,void 0,function*(){if(Object.keys(this.ruleset.compositeRules).length>0&&(yield this.validateCompositeRules()),void 0!==this.ruleset.compositeRules[e])return;const t=this.ruleResolver.resolvePropertyRules(e,this.ruleset);return t?this.validatePropertyWithRules(e,t):void 0})),this.validateCompositeRule=(e=>s(this,void 0,void 0,function*(){const t=this.hasErrors();if(yield e.validate(this.modelResolver)){if(this.propertyErrors[e.virtualPropertyName]){delete this.propertyErrors[e.virtualPropertyName];const t=new u(e.virtualPropertyName,!0);this.propertyStateChangedEvent.publish(t)}return void(t&&this.hasErrors()||this.modelStateChangedEvent.publish(new h(!0)))}const r=this.propertyErrors[e.virtualPropertyName],s=yield this.localeHandler.getMessage(e.virtualPropertyName,e,this.modelResolver,null);if(this.propertyErrors[e.virtualPropertyName]=s,s!=r){const r=new u(e.virtualPropertyName,!1,s);this.propertyStateChangedEvent.publish(r),t||this.modelStateChangedEvent.publish(new h(!1))}return this.propertyErrors[e.virtualPropertyName]})),this.validateCompositeRules=(()=>s(this,void 0,void 0,function*(){for(const e in this.ruleset.compositeRules){const t=this.ruleset.compositeRules[e];yield this.validateCompositeRule(t)}})),this.startValidateModel=(()=>s(this,void 0,void 0,function*(){for(const e in this.ruleset.rules)yield this.startValidateProperty(e)})),this.changeValidationTarget=(e=>{this.modelResolver=this.modelResolverFactory.createModelResolver(e)}),this.validateProperty=(e=>s(this,void 0,void 0,function*(){return yield this.startValidateProperty(e),yield this.promiseCounter.waitForCompletion(),!this.propertyErrors[e]})),this.validate=(()=>s(this,void 0,void 0,function*(){return yield this.startValidateModel(),yield this.promiseCounter.waitForCompletion(),!this.hasErrors()})),this.getModelErrors=((e=!1)=>s(this,void 0,void 0,function*(){return e&&(yield this.startValidateModel()),yield this.promiseCounter.waitForCompletion(),this.propertyErrors})),this.getPropertyError=((e,t=!1)=>s(this,void 0,void 0,function*(){return t&&(yield this.startValidateProperty(e)),yield this.promiseCounter.waitForCompletion(),this.propertyErrors[e]})),this.getPropertyDisplayName=(e=>this.displayNameCache.getDisplayNameFor(e)),this.isPropertyInGroup=(e=>{return null!=this.ruleResolver.resolvePropertyRules(e,this.ruleset)}),this.release=(()=>{}),this.propertyStateChangedEvent=new c.EventHandler(this),this.modelStateChangedEvent=new c.EventHandler(this),this.displayNameCache=new d,this.promiseCounter=new l,this.modelResolver=this.modelResolverFactory.createModelResolver(o),this.displayNameCache.cacheDisplayNamesFor(p)}hasErrors(){return Object.keys(this.propertyErrors).length>0}}class m extends p{constructor(e,t=new a,r,s,i,o,n,l=500){super(e,t,r,i,o,n),this.modelWatcherFactory=s,this.localeHandler=i,this.refreshRate=l,this.onModelChanged=(e=>{this.startValidateProperty(e.propertyPath)}),this.release=(()=>{this.modelWatcher&&this.modelWatcher.stopWatching()}),this.modelWatcher=this.modelWatcherFactory.createModelWatcher(),this.modelWatcher.setupWatcher(o,n,l),this.modelWatcher.onPropertyChanged.subscribe(this.onModelChanged)}}class y{constructor(e,t){this.propertyPath=e,this.previousValue=t}}class v{constructor(e,t,r){this.propertyPath=e,this.newValue=t,this.oldValue=r}}class f{constructor(e=new o.PropertyResolver){this.propertyResolver=e,this.watchCache=[],this.watchCacheKeys=[],this.watcherInterval=null,this.setupWatcher=((e,t,r=500)=>{this.model=e,this.ruleset=t,this.scanInterval=r,this.watchCache=[],this.watchCacheKeys=[],this.cacheWatchTargets("",this.ruleset),this.scanProperties(),this.startWatching()}),this.changeWatcherTarget=(e=>{this.model=e,this.scanProperties()}),this.startWatching=(()=>{this.stopWatching(),this.watcherInterval=setInterval(this.scanProperties,this.scanInterval)}),this.stopWatching=(()=>{this.watcherInterval&&clearInterval(this.watcherInterval)}),this.updateAndNotifyDifferences=(()=>{const e=this.watchCacheKeys,t=this.watchCache;this.watchCache=[],this.watchCacheKeys=[],this.cacheWatchTargets("",this.ruleset),this.watchCacheKeys.forEach((r,s)=>{let i;if(-1==e.indexOf(r)){i=this.watchCache[s].previousValue;const e=new v(r,i,null);setTimeout(()=>{this.onPropertyChanged.publish(e)},1)}else if(t[s].previousValue&&t[s].previousValue.isArray&&t[s].previousValue.length!=this.watchCache[s].previousValue.length){const e=this.watchCache[s].previousValue;i=t[s].previousValue;const o=new v(r,e,i);setTimeout(()=>{this.onPropertyChanged.publish(o)},1)}})}),this.watchProperty=((e,t)=>{if(-1==this.watchCacheKeys.indexOf(e)){const r=new y(e,t);this.watchCache.push(r),this.watchCacheKeys.push(e)}}),this.cacheWatchTargets=((e,t)=>{let r,s,i,o,a,l;for(const u in t.rules){r=e?e+"."+u:u,s=t.rules[u],i=!1,o=!1,s.forEach(function(e){e.isForEach&&(i=!0),e.getRulesForProperty&&(o=!0)}),a=!1;try{l=this.propertyResolver.resolveProperty(this.model,r),a=!0}catch(e){}null==l&&(i||o)&&(l=i?[]:o?{}:null),s.forEach(e=>{const t=n.isArrayType(l);if(t){const e={length:l.length,isArray:!0};this.watchProperty(r,e)}e.isForEach&&a?e.internalRule.getRulesForProperty?this.model[u]&&this.model[u].forEach((t,s)=>{this.cacheWatchTargets(r+"["+s+"]",e.internalRule)}):this.model[u]&&this.model[u].forEach((e,t)=>{this.watchProperty(r+"["+t+"]",this.model[u][t])}):e.getRulesForProperty?this.cacheWatchTargets(r,e):t||this.watchProperty(r,l)})}}),this.scanProperties=(()=>{if(0==this.onPropertyChanged.getSubscriptionCount())return;if(0==this.watchCache.length)return;let e=!1;this.watchCache.forEach(t=>{let r,s=!1;try{r=this.propertyResolver.resolveProperty(this.model,t.propertyPath)}catch(e){}if(void 0===r&&(r=t.previousValue),t.previousValue&&t.previousValue.isArray){(r.length||0)!=t.previousValue.length&&(s=!0)}else if(r!==t.previousValue){const e=new v(t.propertyPath,r,t.previousValue);setTimeout(()=>{this.onPropertyChanged.publish(e)},1),t.previousValue=r}s&&(e=!0)}),e&&setTimeout(this.updateAndNotifyDifferences,1)}),this.onPropertyChanged=new c.EventHandler(this)}}class g{constructor(){this.createModelWatcher=(()=>new f)}}class R{constructor(e,t){this.propertyResolver=e,this.model=t}resolve(e){return this.propertyResolver.resolveProperty(this.model,e)}}class F{constructor(e=new o.PropertyResolver){this.propertyResolver=e,this.createModelResolver=(e=>new R(this.propertyResolver,e))}}class E{constructor(e,t,r){this.fieldErrorProcessor=e,this.ruleResolver=t,this.localeHandler=r,this.create=(()=>(this.refreshRate=500,this.validateOnStart=!1,this.modelWatcherFactory=new g,this.modelResolverFactory=new F,this)),this.withRefreshRate=(e=>(this.refreshRate=e,this)),this.withModelResolverFactory=(e=>(this.modelResolverFactory=e,this)),this.withModelWatcherFactory=(e=>(this.modelWatcherFactory=e,this)),this.andValidateOnStart=(()=>(this.validateOnStart=!0,this)),this.build=((e,t)=>{const r=new m(this.fieldErrorProcessor,this.ruleResolver,this.modelResolverFactory,this.modelWatcherFactory,this.localeHandler,e,t,this.refreshRate);return this.validateOnStart&&r.validate(),r})}}class w{constructor(e,t,r){this.fieldErrorProcessor=e,this.ruleResolver=t,this.localeHandler=r,this.create=(()=>(this.modelResolverFactory=new F,this.validateOnStart=!1,this)),this.asReactiveGroup=(()=>{return new E(this.fieldErrorProcessor,this.ruleResolver,this.localeHandler).create().withModelResolverFactory(this.modelResolverFactory)}),this.withModelResolverFactory=(e=>(this.modelResolverFactory=e,this)),this.andValidateOnStart=(()=>(this.validateOnStart=!0,this)),this.build=((e,t)=>{const r=new p(this.fieldErrorProcessor,this.ruleResolver,this.modelResolverFactory,this.localeHandler,e,t);return this.validateOnStart&&r.validate(),r})}}class P{static simpleTypeComparer(e,t,r){return r?e==t:e===t}static dateTimeCompararer(e,t){return e.getTime()==t.getTime()}}let b;b||((b=new class{constructor(){this.rules={},this.registerRule=(e=>{this.rules[e.ruleName]=e}),this.unregisterRule=(e=>{delete this.rules[e.ruleName]}),this.getRuleNamed=(e=>this.rules[e]||null),this.hasRuleNamed=(e=>null!=this.getRuleNamed(e))}}).registerRule(new class{constructor(){this.ruleName="date",this.invalidObjectRegex=/Invalid|NaN/}validate(e,t){return s(this,void 0,void 0,function*(){const r=e.resolve(t);return!!n.isEmptyValue(r)||!this.invalidObjectRegex.test(new Date(r))})}}),b.registerRule(new class{constructor(){this.ruleName="decimal",this.decimalRegex=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/}validate(e,t){return s(this,void 0,void 0,function*(){const r=e.resolve(t);return!!n.isEmptyValue(r)||this.decimalRegex.test(r)})}}),b.registerRule(new class{constructor(){this.ruleName="email",this.emailRegex=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/}validate(e,t){return s(this,void 0,void 0,function*(){const r=e.resolve(t);return!!n.isEmptyValue(r)||this.emailRegex.test(r)})}}),b.registerRule(new class{constructor(){this.ruleName="equal"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);if(n.isEmptyValue(s))return!0;let i=r.value||r;const o=r.weakEquality||!1;return n.isFunctionType(i)&&(i=i()),n.isDateType(i)?P.dateTimeCompararer(s,i):P.simpleTypeComparer(s,i,o)})}}),b.registerRule(new class{constructor(){this.ruleName="isoDate",this.isoDateRegex=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/}validate(e,t){return s(this,void 0,void 0,function*(){const r=e.resolve(t);return!!n.isEmptyValue(r)||this.isoDateRegex.test(r)})}}),b.registerRule(new class{constructor(){this.ruleName="maxLength"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);return!!n.isEmptyValue(s)||s.length<=r})}}),b.registerRule(new class{constructor(){this.ruleName="maxValue"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);return!!n.isEmptyValue(s)||s<=r})}}),b.registerRule(new class{constructor(){this.ruleName="minLength"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);return!!n.isEmptyValue(s)||s.length>=r})}}),b.registerRule(new class{constructor(){this.ruleName="minValue"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);return!!n.isEmptyValue(s)||s>=r})}}),b.registerRule(new class{constructor(){this.ruleName="notEqual"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);if(n.isEmptyValue(s))return!0;let i=r.value||r;const o=r.weakEquality||!1;return n.isFunctionType(i)&&(i=i()),n.isDateType(i)?!P.dateTimeCompararer(s,i):!P.simpleTypeComparer(s,i,o)})}}),b.registerRule(new class{constructor(){this.ruleName="number",this.numberRegex=/^\d+$/}validate(e,t){return s(this,void 0,void 0,function*(){const r=e.resolve(t);return!!n.isEmptyValue(r)||this.numberRegex.test(r)})}}),b.registerRule(new class{constructor(){this.ruleName="regex"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);return!!n.isEmptyValue(s)||null!==s.toString().match(r)})}}),b.registerRule(new class{constructor(){this.ruleName="required"}validate(e,t,r=!0){return s(this,void 0,void 0,function*(){const s=e.resolve(t);if(void 0===s||null===s)return!r;let i=s;return"string"==typeof i&&(i=String.prototype.trim?s.trim():s.replace(/^\s+|\s+$/g,"")),!r||(i+"").length>0})}}),b.registerRule(new class{constructor(){this.ruleName="step"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);if(n.isEmptyValue(s))return!0;const i=100*s%(100*r);return Math.abs(i)<1e-5||Math.abs(1-i)<1e-5})}}),b.registerRule(new class{constructor(){this.ruleName="matches"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=r.property||r,i=r.weakEquality||!1,o=e.resolve(t),a=e.resolve(s);return void 0===o||null===o?void 0===a||null===a:n.isDateType(o)?P.dateTimeCompararer(o,a):P.simpleTypeComparer(o,a,i)})}}));class C{constructor(){this.rules={},this.compositeRules={},this.propertyDisplayNames={},this.createPropertyEntryIfNeeded=(e=>{this.rules[e]||(this.rules[e]=[])}),this.addRule=((e,t)=>{this.createPropertyEntryIfNeeded(e),this.rules[e].push(t)}),this.addRuleset=((e,t)=>{this.createPropertyEntryIfNeeded(e),this.rules[e].push(t)}),this.addCompositeRule=(e=>{this.compositeRules[e.virtualPropertyName]=e}),this.addPropertyDisplayName=((e,t)=>this.propertyDisplayNames[e]=t),this.getRulesForProperty=(e=>this.rules[e]),this.getCompositeRulesRulesForProperty=(e=>this.compositeRules[e])}}class x{constructor(e,t){this.ruleName=e,this.ruleOptions=t,this.appliesIf=!0}}class N{constructor(e){this.internalRule=e,this.isForEach=!0}}class V{constructor(e,t){this.virtualPropertyName=e,this.validate=t}}class S{constructor(e){this.ruleRegistry=e,this.verifyExistingProperty=(()=>{if(!this.currentProperty)throw new Error("A property must precede any rule calls in the chain")}),this.verifyRuleNameIsValid=(e=>{if(null==e||void 0===e||0==e.length)throw new Error("A rule name is required");if(this.ruleRegistry&&!this.ruleRegistry.hasRuleNamed(e))throw new Error(`The rule [${e}] has not been registered`)}),this.create=(e=>(this.internalRuleset=e||new C,this.currentProperty=null,this)),this.mergeInRuleset=(e=>(this.internalRuleset.rules=Object.assign({},this.internalRuleset.rules,e.rules),this.internalRuleset.compositeRules=Object.assign({},this.internalRuleset.compositeRules,e.compositeRules),this.internalRuleset.propertyDisplayNames=Object.assign({},this.internalRuleset.propertyDisplayNames,e.propertyDisplayNames),this)),this.forProperty=(e=>{let t=e;if(n.isFunctionType(t)&&!(t=this.extractPropertyName(e)))throw new Error(`cannot resolve property from: ${e}`);return this.currentProperty=t,this.currentRule=null,this}),this.then=(e=>{this.verifyExistingProperty();const t=(new S).create();e(t);const r=t.build();return this.addRuleset(r)}),this.thenForEach=(e=>{this.verifyExistingProperty();const t=(new S).create();e(t);const r=t.build();return this.addRulesetForEach(r)}),this.addRule=((e,t)=>(this.verifyRuleNameIsValid(e),this.verifyExistingProperty(),this.internalRuleset.addRule(this.currentProperty,this.currentRule=new x(e,t)),this)),this.addCompositeRule=(e=>(this.internalRuleset.compositeRules[e.virtualPropertyName]=e,this)),this.withDisplayName=(e=>(this.verifyExistingProperty(),this.internalRuleset.propertyDisplayNames[this.currentProperty]=e,this)),this.addDynamicRule=((e,t)=>{const r=new V(e,t);return this.internalRuleset.compositeRules[e]=r,this}),this.withMessage=(e=>(this.verifyExistingProperty(),this.currentRule.messageOverride=e,this)),this.appliesIf=(e=>(this.verifyExistingProperty(),this.currentRule.appliesIf=e,this)),this.addRuleForEach=((e,t)=>{this.verifyRuleNameIsValid(e),this.verifyExistingProperty();const r=new x(e,t);return this.currentRule=r,this.internalRuleset.addRule(this.currentProperty,new N(r)),this}),this.addRuleset=(e=>(this.verifyExistingProperty(),this.internalRuleset.addRuleset(this.currentProperty,e),this)),this.addRulesetForEach=(e=>(this.verifyExistingProperty(),this.internalRuleset.addRuleset(this.currentProperty,new N(e)),this)),this.build=(()=>this.internalRuleset),this.required=(()=>this.addRule("required")),this.date=(()=>this.addRule("date")),this.decimal=(()=>this.addRule("decimal")),this.email=(()=>this.addRule("email")),this.isoDate=(()=>this.addRule("isoDate")),this.number=(()=>this.addRule("number")),this.equal=(e=>this.addRule("equal",e)),this.notEqual=(e=>this.addRule("notEqual",e)),this.minValue=(e=>this.addRule("minValue",e)),this.maxValue=(e=>this.addRule("maxValue",e)),this.minLength=(e=>this.addRule("minLength",e)),this.maxLength=(e=>this.addRule("maxLength",e)),this.regex=(e=>this.addRule("regex",e)),this.step=(e=>this.addRule("step",e)),this.matches=(e=>{let t=e;if(n.isFunctionType(t)&&!(t=this.extractPropertyName(e)))throw new Error(`cannot resolve property from: ${e}`);return this.addRule("matches",t)})}extractPropertyName(e){const t=e.toString();return/.*\.([\w]*)/.exec(t)[1]}static create(e){return(new S).create(e)}}const D=new class{constructor(){this.localeResources={},this.getCurrentLocale=(()=>this.localeCode),this.registerLocale=((e,t)=>s(this,void 0,void 0,function*(){this.localeCode=e,this.localeResources[this.localeCode]=t})),this.useLocale=(e=>s(this,void 0,void 0,function*(){if(!this.localeResources[e])throw`Unable to find registered locale for [${e}]`;this.localeCode=e})),this.supplementLocaleFrom=((e,t)=>s(this,void 0,void 0,function*(){this.localeResources[e]||(this.localeResources[e]={});for(const r in t)this.localeResources[e][r]=t[r]})),this.getMessage=((e,t,r,i)=>s(this,void 0,void 0,function*(){const s=this.localeResources[this.localeCode],o=s[e]||s.default||`Cannot find rule for ${e}`;return"string"==typeof o?o:3===o.length||null==i?o(r,i,t):o(r.resolve(i),t)}))}};D.registerLocale("en-us",{default:"This field is invalid",required:"This field is required",date:e=>`This field contains "${e}" which is not a valid date`,decimal:e=>`This field contains ${e} which is not a decimal value`,equal:(e,t)=>`This field is ${e} but should be equal to ${t.value||t}`,notEqual:(e,t)=>`This field is ${e} but should not be equal to ${t.value||t}`,isoDate:e=>`This field contains "${e}" which is not a valid ISO date`,maxLength:(e,t)=>`This field has a length of ${e.length} but should contain no more than ${t}`,minLength:(e,t)=>`This field has a length of ${e.length} but should more than ${t}`,maxValue:(e,t)=>`This field has a value of ${e} but should be less than or equal to ${t}`,minValue:(e,t)=>`This field has a value of ${e} but should be greater than or equal to ${t}`,number:e=>`This field contains ${e} which is not a numeric value`,regex:"This field does not match the expected format",step:(e,t)=>`This field has a value of ${e} and should be an increment of ${t}`,matches:(e,t,r)=>{const s=e.resolve(t),i=r.property||r;return`This field is ${s} but should match ${e.resolve(i)}`}}),D.useLocale("en-us");const T=new class{constructor(e,t){this.ruleRegistry=e,this.localeHandler=t,this.processRuleLink=((e,t,r)=>s(this,void 0,void 0,function*(){if(!(!0===r.appliesIf||"function"==typeof r.appliesIf&&r.appliesIf(e,t,r.ruleOptions)))return;const s=this.ruleRegistry.getRuleNamed(r.ruleName);if(!s)throw new i(`No validator can be found for rule [${r.ruleName}]`);const o="function"==typeof r.ruleOptions?r.ruleOptions():r.ruleOptions;if(yield s.validate(e,t,o))return;let a;throw a=r.messageOverride?"function"==typeof r.messageOverride?r.messageOverride(e,t,r.ruleOptions):r.messageOverride:yield this.localeHandler.getMessage(r.ruleName,r.ruleOptions,e,t),new i(a)})),this.checkFieldForErrors=((e,t,r)=>s(this,void 0,void 0,function*(){const s=r=>this.processRuleLink(e,t,r);return Promise.resolve(r).then(e=>{const t=[];return e.forEach(e=>{t.push(s(e))}),Promise.all(t)}).then(function(){return null}).catch(e=>e.message)}))}}(b,D),O=new a;function $(e,t=!1){return(t?new S(b):new S).create(e)}class A{}A.hasClass=((e,t)=>e.classList?e.classList.contains(t):!!e.className.match(new RegExp(`(\\s|^)${t}(\\s|$)`))),A.addClass=((e,t)=>{e.classList?e.classList.add(t):A.hasClass(e,t)||(e.errorClassName+=" "+t)}),A.removeClass=((e,t)=>{if(e.classList)e.classList.remove(t);else if(A.hasClass(e,t)){const r=new RegExp(`(\\s|^)${t}(\\s|$)`);e.errorClassName=e.className.replace(r," ")}});class I{constructor(){this.getElementValidatorId=(e=>(e.getAttribute("id")||e.setAttribute("id","unique-"+I.currentCount++),e.getAttribute("id")+"-error-container")),this.createErrorElement=((e,t)=>{let r=this.getElementValidatorId(t),s=document.createElement("div");return s.id=r,s.className="validation-error-container",s.textContent=e,t.parentElement.appendChild(s),s}),this.removeErrorElement=function(e){let t=this.getElementValidatorId(e),r=document.getElementById(t);r&&r.parentElement.removeChild(r)},this.addElementError=function(e,t){let r=this.getElementValidatorId(t);return document.getElementById(r)?(this.removeErrorElement(t),this.createErrorElement(e,t)):this.createErrorElement(e,t)}}}I.currentCount=1;class M{constructor(){this.applyContainerClass=(e=>{A.addClass(e,M.containerClassName)}),this.getPropertyElementName=(e=>{let t=e.replace(/[\[\].]/g,"-");return`${M.elementIdFormat}${t}`}),this.getPropertyErrorElement=((e,t)=>{let r=this.getPropertyElementName(t);return e.querySelector(`#${r}`)}),this.createPropertyErrorElement=((e,t,r)=>{let s=this.getPropertyElementName(r),i=document.createElement("div");return i.id=s,i.className=M.errorClassName,i.textContent=e,i.setAttribute("property-route",r),t.appendChild(i),i}),this.removePropertyErrorElement=((e,t)=>{let r=this.getPropertyErrorElement(e,t);r&&e.removeChild(r)})}}M.elementIdFormat="summary-error-for-",M.errorClassName="summary-error",M.containerClassName="validation-summary-container";var W=new class{constructor(){this.strategies={},this.registerStrategy=(e=>{this.strategies[e.strategyName]=e}),this.unregisterStrategy=(e=>{delete this.strategies[e.strategyName]}),this.getStrategyNamed=(e=>this.strategies[e]||null),this.hasStrategyNamed=(e=>null!=this.getStrategyNamed(e))}};W.registerStrategy(new class{constructor(e=new I){this.inlineHandler=e,this.strategyName="inline"}propertyBecomeValid(e){A.removeClass(e,"invalid"),A.addClass(e,"valid"),this.inlineHandler.removeErrorElement(e)}propertyBecomeInvalid(e,t){A.removeClass(e,"valid"),A.addClass(e,"invalid"),this.inlineHandler.addElementError(t,e)}});var L,j=new class{constructor(){this.summaries={},this.registerSummary=(e=>{this.summaries[e.summaryName]=e}),this.unregisterSummary=(e=>{delete this.summaries[e.summaryName]}),this.getSummaryNamed=(e=>this.summaries[e]||null),this.hasSummaryNamed=(e=>null!=this.getSummaryNamed(e))}};j.registerSummary(new class{constructor(e=new M){this.summaryHandler=e,this.summaryName="default"}setupContainer(e){this.summaryHandler.applyContainerClass(e)}propertyBecomeValid(e,t){this.summaryHandler.removePropertyErrorElement(e,t)}propertyBecomeInvalid(e,t,r){let s=`${r} - ${t}`;this.summaryHandler.removePropertyErrorElement(e,r),this.summaryHandler.createPropertyErrorElement(s,e,r)}});class k{static literalToJson(e){let t,r=`{ ${e} }`.replace(k.jsLiteralRegex,'$1"$2":');try{t=JSON.parse(r)}catch(t){console.warn(`unable to process literal: ${e}`,t)}return t||{}}}k.jsLiteralRegex=/({|,)(?:\s*)(?:')?([A-Za-z_$\.][A-Za-z0-9_ \-\.$]*)(?:')?(?:\s*):/g;class _{static getPropertyRouteFrom(e){return e.getAttribute(_.ValidatePropertyAttributeName)}static getViewStrategyFrom(e){return e.getAttribute(_.ViewStrategyAttributeName)}static getViewOptionsFrom(e){let t=e.getAttribute(_.ViewOptionsAttributeName);if(t)return k.literalToJson(t)}static getSummaryStrategyFrom(e){return e.getAttribute(_.ViewSummaryStrategyAttributeName)}static getSummaryOptionsFrom(e){let t=e.getAttribute(_.SummaryOptionsAttributeName);if(t)return k.literalToJson(t)}}_.ValidatePropertyAttributeName="validate-property",_.ViewStrategyAttributeName="view-strategy",_.ViewOptionsAttributeName="view-options",_.ViewSummaryStrategyAttributeName="view-summary-strategy",_.SummaryOptionsAttributeName="summary-options",function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid"}(L||(L={})),r.d(t,"ValidateWith",function(){return H}),r.d(t,"viewStrategyRegistry",function(){return W}),r.d(t,"createRuleset",function(){return $}),r.d(t,"ruleRegistry",function(){return b});const q="summary-subscriptions",H=(e,t={})=>({data:()=>({validationGroup:null,modelErrors:{}}),computed:{isValid:function(){return 0==Object.keys(this.modelErrors).length}},watch:{isValid:function(e){this.$emit("model-state-changed",{isValid:e,errors:this.modelErrors})}},created(){const r=this;void 0===t.withReactiveValidation&&(t.withReactiveValidation=!1),void 0===t.validateComputed&&(t.validateComputed=!1),void 0===t.validateProps&&(t.validateProps=!1),void 0===t.validateOnStart&&(t.validateOnStart=!1);const s={get:(e,s)=>Reflect.has(e,s)?Reflect.get(e,s):t.validateProps&&Reflect.has(r._props,s)?Reflect.get(r._props,s):t.validateComputed&&Reflect.has(r._computed,s)?Reflect.get(r._computed,s):void 0},i=new Proxy(r._data,s);let o=new w(T,O,D).create();t.withReactiveValidation&&(o=o.asReactiveGroup()),t.validateOnStart&&(o=o.andValidateOnStart());const a={};r.validationGroup=o.build(i,e),r._validationMetadata=a,t.withReactiveValidation&&(a["reactive-subscription"]=r.validationGroup.propertyStateChangedEvent.subscribe(e=>{e.isValid?r.$delete(r.modelErrors,e.property):r.$set(r.modelErrors,e.property,e.error)})),a["validation-subscriptions"]={},a[q]=[]},beforeDestroy(){const e=this._validationMetadata;e["reactive-subscription"]&&e["reactive-subscription"](),this.validationGroup.release()}}),z={bind:function(e,t,r){const s=r.context,i=s.validationGroup;if(!i)return;const o=s._validationMetadata,a=_.getPropertyRouteFrom(e);if(!a)return;const n=i.getPropertyDisplayName(a),l=_.getViewStrategyFrom(e),u=W.getStrategyNamed(l||"inline");if(!u)return;let h=L.unknown;const c=_.getViewOptionsFrom(e)||{};const d=i.propertyStateChangedEvent.subscribe(t=>{(t=>{t?(u.propertyBecomeInvalid(e,t,a,h,c),h=L.invalid,o["reactive-subscription"]||s.$set(s.modelErrors,n,t)):(u.propertyBecomeValid(e,a,h,c),h=L.valid,o["reactive-subscription"]||s.$delete(s.modelErrors,n))})(t.error)},e=>e.property==a);o["validation-subscriptions"][a]=d},unbind:function(e,t,r){let s=r.context,i=_.getPropertyRouteFrom(e);if(!i)return;let o=s._validationMetadata["validation-subscriptions"][i];o&&o()}},B={bind:function(e,t,r){const s=r.context;s._validationMetadata||(s._validationMetadata={},s._validationMetadata[q]=[]);const i=s._validationMetadata;let o=null;if(!(o=null!=t.value?t.value:s.validationGroup))return;const a=Array.isArray(o),n=_.getSummaryStrategyFrom(e),l=j.getSummaryNamed(n||"default");if(!l)return;const h=_.getSummaryOptionsFrom(e)||{};l.setupContainer(e,h);const c=t=>{const r=(e=>{if(!a)return o.getPropertyDisplayName(e);let t=e;return o.forEach(r=>{let s=r.getPropertyDisplayName(e);s!=e&&(t=s)}),t})(t.property);t.isValid?l.propertyBecomeValid(e,r,h):l.propertyBecomeInvalid(e,t.error,r,h)},d=e=>{e.getModelErrors(!1).then(e=>{for(const t in e)c(new u(t,!1,e[t]))})};if(a)o.forEach(e=>{const t=e.propertyStateChangedEvent.subscribe(c);i[q].push(t),d(e)});else{const e=o.propertyStateChangedEvent.subscribe(c);i[q].push(e),d(o)}},unbind:function(e,t,r){const s=r.context._validationMetadata;s[q]&&s[q].forEach(e=>e())}};t.default={install:function(e,t){e.directive("show-error",z),e.directive("validation-summary",B)}}}])});