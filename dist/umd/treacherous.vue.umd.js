!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@treacherous/core")):"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TreacherousVue=t(require("@treacherous/core")):e.TreacherousVue=t(e.Treacherous)}(window,(function(e){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(a,i,function(t){return e[t]}.bind(null,i));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(t,r){t.exports=e},function(e,t,r){"use strict";r.r(t),r.d(t,"ValidateWith",(function(){return y})),r.d(t,"viewStrategyRegistry",(function(){return s})),r.d(t,"createRuleset",(function(){return a.createRuleset})),r.d(t,"ruleRegistry",(function(){return a.ruleRegistry}));var a=r(0);class i{}i.hasClass=(e,t)=>e.classList?e.classList.contains(t):!!e.className.match(new RegExp(`(\\s|^)${t}(\\s|$)`)),i.addClass=(e,t)=>{e.classList?e.classList.add(t):i.hasClass(e,t)||(e.errorClassName+=" "+t)},i.removeClass=(e,t)=>{if(e.classList)e.classList.remove(t);else if(i.hasClass(e,t)){const r=new RegExp(`(\\s|^)${t}(\\s|$)`);e.errorClassName=e.className.replace(r," ")}};class n{constructor(){this.getElementValidatorId=e=>(e.getAttribute("id")||e.setAttribute("id","unique-"+n.currentCount++),e.getAttribute("id")+"-error-container"),this.createErrorElement=(e,t)=>{let r=this.getElementValidatorId(t),a=document.createElement("div");return a.id=r,a.className="validation-error-container",a.textContent=e,t.parentElement.appendChild(a),a},this.removeErrorElement=function(e){let t=this.getElementValidatorId(e),r=document.getElementById(t);r&&r.parentElement.removeChild(r)},this.addElementError=function(e,t){let r=this.getElementValidatorId(t);return document.getElementById(r)?(this.removeErrorElement(t),this.createErrorElement(e,t)):this.createErrorElement(e,t)}}}n.currentCount=1;class o{constructor(){this.applyContainerClass=e=>{i.addClass(e,o.containerClassName)},this.getPropertyElementName=e=>{let t=e.replace(/[\W]/g,"-");return`${o.elementIdFormat}${t}`},this.getPropertyErrorElement=(e,t)=>{let r=this.getPropertyElementName(t);return e.querySelector("#"+r)},this.createPropertyErrorElement=(e,t,r)=>{let a=this.getPropertyElementName(r),i=document.createElement("div");return i.id=a,i.className=o.errorClassName,i.textContent=e,i.setAttribute("property-route",r),t.appendChild(i),i},this.removePropertyErrorElement=(e,t)=>{let r=this.getPropertyErrorElement(e,t);r&&e.removeChild(r)}}}o.elementIdFormat="summary-error-for-",o.errorClassName="summary-error",o.containerClassName="validation-summary-container";var s=new class{constructor(){this.strategies={},this.registerStrategy=e=>{this.strategies[e.strategyName]=e},this.unregisterStrategy=e=>{delete this.strategies[e.strategyName]},this.getStrategyNamed=e=>this.strategies[e]||null,this.hasStrategyNamed=e=>null!=this.getStrategyNamed(e)}};s.registerStrategy(new class{constructor(e=new n){this.inlineHandler=e,this.strategyName="inline"}propertyBecomeValid(e){i.removeClass(e,"invalid"),i.addClass(e,"valid"),this.inlineHandler.removeErrorElement(e)}propertyBecomeInvalid(e,t){i.removeClass(e,"valid"),i.addClass(e,"invalid"),this.inlineHandler.addElementError(t,e)}});var l,u=new class{constructor(){this.summaries={},this.registerSummary=e=>{this.summaries[e.summaryName]=e},this.unregisterSummary=e=>{delete this.summaries[e.summaryName]},this.getSummaryNamed=e=>this.summaries[e]||null,this.hasSummaryNamed=e=>null!=this.getSummaryNamed(e)}};u.registerSummary(new class{constructor(e=new o){this.summaryHandler=e,this.summaryName="default"}setupContainer(e){this.summaryHandler.applyContainerClass(e)}propertyBecomeValid(e,t){this.summaryHandler.removePropertyErrorElement(e,t)}propertyBecomeInvalid(e,t,r){let a=`${r} - ${t}`;this.summaryHandler.removePropertyErrorElement(e,r),this.summaryHandler.createPropertyErrorElement(a,e,r)}});class c{static literalToJson(e){let t,r=`{ ${e} }`.replace(c.jsLiteralRegex,'$1"$2":');try{t=JSON.parse(r)}catch(t){console.warn("unable to process literal: "+e,t)}return t||{}}}c.jsLiteralRegex=/({|,)(?:\s*)(?:')?([A-Za-z_$\.][A-Za-z0-9_ \-\.$]*)(?:')?(?:\s*):/g;class d{static getPropertyRouteFrom(e){return e.getAttribute(d.ValidatePropertyAttributeName)}static getViewStrategyFrom(e){return e.getAttribute(d.ViewStrategyAttributeName)}static getViewOptionsFrom(e){let t=e.getAttribute(d.ViewOptionsAttributeName);if(t)return c.literalToJson(t)}static getSummaryStrategyFrom(e){return e.getAttribute(d.ViewSummaryStrategyAttributeName)}static getSummaryOptionsFrom(e){let t=e.getAttribute(d.SummaryOptionsAttributeName);if(t)return c.literalToJson(t)}}d.ValidatePropertyAttributeName="validate-property",d.ViewStrategyAttributeName="view-strategy",d.ViewOptionsAttributeName="view-options",d.ViewSummaryStrategyAttributeName="view-summary-strategy",d.SummaryOptionsAttributeName="summary-options",function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid"}(l||(l={}));var m=function(e,t,r,a){return new(r||(r=Promise))((function(i,n){function o(e){try{l(a.next(e))}catch(e){n(e)}}function s(e){try{l(a.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const p="summary-subscriptions",y=(e,t={})=>({data:()=>({modelErrors:{}}),computed:{isValid:function(){return 0==Object.keys(this.modelErrors).length}},watch:{isValid:function(e){this.$emit("model-state-changed",{isValid:e,errors:this.modelErrors})}},methods:{getValidationGroup:function(){return this._validationGroup},refreshValidation:function(){return m(this,void 0,void 0,(function*(){const e=yield this._validationGroup.getModelErrors(!0);(e=>{for(const t in e)delete e.key})(this.modelErrors),((e,t)=>{for(const r in t)e[r]=t[r]})(this.modelErrors,e)}))}},beforeMount(){const r=this;void 0===t.withReactiveValidation&&(t.withReactiveValidation=!1),void 0===t.validateComputed&&(t.validateComputed=!1),void 0===t.validateProps&&(t.validateProps=!1),void 0===t.validateOnStart&&(t.validateOnStart=!1);const i={get:(e,a)=>Reflect.has(e,a)?Reflect.get(e,a):t.validateProps&&Reflect.has(r.$props,a)?Reflect.get(r.$props,a):t.validateComputed&&Reflect.has(r.$computed,a)?Reflect.get(r.$computed,a):void 0},n=new Proxy(r.$data,i);let o=Object(a.createGroup)();t.withReactiveValidation&&(o=o.asReactiveGroup()),t.validateOnStart&&(o=o.andValidateOnStart());const s={};r._validationGroup=o.build(n,e),r._validationMetadata=s,t.withReactiveValidation&&(s["reactive-subscription"]=r._validationGroup.propertyStateChangedEvent.subscribe(e=>{e.isValid?delete r.modelErrors[e.property]:r.modelErrors[e.property]=e.error})),s["validation-subscriptions"]={},s[p]=[]},beforeUnmount(){const e=this._validationMetadata;e["reactive-subscription"]&&e["reactive-subscription"](),this._validationGroup.release()}}),v={beforeMount:function(e,t){const r=t.instance,a=r._validationGroup;if(!a)return;const i=r._validationMetadata,n=d.getPropertyRouteFrom(e);if(!n)return;const o=a.getPropertyDisplayName(n),u=d.getViewStrategyFrom(e),c=s.getStrategyNamed(u||"inline");if(!c)return;let m=l.unknown;const p=d.getViewOptionsFrom(e)||{};const y=a.propertyStateChangedEvent.subscribe(t=>{var a;(a=t.error)?(c.propertyBecomeInvalid(e,a,n,m,p),m=l.invalid,i["reactive-subscription"]||(r.modelErrors[o]=a)):(c.propertyBecomeValid(e,n,m,p),m=l.valid,i["reactive-subscription"]||delete r.modelErrors[o])},e=>e.property==n);i["validation-subscriptions"][n]=y},unmounted:function(e,t){let r=t.instance,a=d.getPropertyRouteFrom(e);if(!a)return;let i=r._validationMetadata["validation-subscriptions"][a];i&&i()}},h={beforeMount:function(e,t){const r=t.instance;r._validationMetadata||(r._validationMetadata={},r._validationMetadata[p]=[]);const i=r._validationMetadata;let n=null;if(n=null!=t.value?t.value:r._validationGroup,!n)return;const o=Array.isArray(n),s=d.getSummaryStrategyFrom(e),l=u.getSummaryNamed(s||"default");if(!l)return;const c=d.getSummaryOptionsFrom(e)||{};l.setupContainer(e,c);const m=t=>{const r=(e=>{if(!o)return n.getPropertyDisplayName(e);let t=e;return n.forEach(r=>{let a=r.getPropertyDisplayName(e);a!=e&&(t=a)}),t})(t.property);t.isValid?l.propertyBecomeValid(e,r,c):l.propertyBecomeInvalid(e,t.error,r,c)},y=e=>{e.getModelErrors(!1).then(e=>{for(const t in e)m(new a.PropertyStateChangedEvent(t,!1,e[t]))})};if(o)n.forEach(e=>{const t=e.propertyStateChangedEvent.subscribe(m);i[p].push(t),y(e)});else{const e=n.propertyStateChangedEvent.subscribe(m);i[p].push(e),y(n)}},unmounted:function(e,t){const r=t.instance._validationMetadata;r[p]&&r[p].forEach(e=>e())}};t.default={install:function(e,t){e.directive("show-error",v),e.directive("validation-summary",h)}}}])}));